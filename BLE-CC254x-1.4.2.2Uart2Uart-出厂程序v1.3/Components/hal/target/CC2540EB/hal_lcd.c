#include "hal_types.h"
#include "hal_lcd.h"
#include "OSAL.h"
#include "OnBoard.h"
#include "stdio.h"

#if (HAL_LCD == TRUE)

#if (HAL_UART == TRUE)
#ifdef LCD_TO_UART      // 串口输出显示的内容
  #include "npi.h"
#endif
#endif
const char ASCII_6x12[11][12]={
{0x07,0x08,0x08,0x08,0x07,0x00,0xE0,0x10,0x10,0x10,0xE0,0x00},/*"0",0*/
{0x00,0x04,0x0F,0x00,0x00,0x00,0x00,0x10,0xF0,0x10,0x00,0x00},/*"1",1*/
{0x06,0x08,0x08,0x09,0x06,0x00,0x30,0x50,0x90,0x10,0x10,0x00},/*"2",2*/
{0x04,0x08,0x09,0x09,0x06,0x00,0x20,0x10,0x10,0x10,0xE0,0x00},/*"3",3*/
{0x00,0x03,0x04,0x0F,0x00,0x00,0x80,0x40,0x40,0xF0,0x50,0x00},/*"4",4*/
{0x0F,0x09,0x09,0x09,0x08,0x00,0x20,0x10,0x10,0x10,0xE0,0x00},/*"5",5*/
{0x07,0x09,0x09,0x0D,0x00,0x00,0xE0,0x10,0x10,0x10,0xE0,0x00},/*"6",6*/
{0x0C,0x08,0x09,0x0E,0x08,0x00,0x00,0x00,0xF0,0x00,0x00,0x00},/*"7",7*/
{0x06,0x09,0x09,0x09,0x06,0x00,0xE0,0x10,0x10,0x10,0xE0,0x00},/*"8",8*/
{0x07,0x08,0x08,0x08,0x07,0x00,0x00,0xB0,0x90,0x90,0xE0,0x00},/*"9",9*/
{0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00}};/*":",10*/

const char HZ_12x12[41][24]={
{0x08,0x44,0x20,0x08,0x1B,0x2A,0xCA,0x0A,0x0A,0x1B,0x0C,0x00,0x20,0x40,0x80,0x00,0xF0,0x20,0x20,0x20,0x20,0xF0,0x00,0x00},/*"治",0*/
{0x10,0x09,0x3F,0x20,0x28,0xA8,0x68,0x29,0x2A,0x2C,0x20,0x00,0x90,0x20,0xC0,0x00,0x00,0x10,0x10,0xF0,0x00,0x00,0x00,0x00},/*"疗",1*/
{0x7F,0x44,0x44,0x7F,0x00,0x10,0x12,0x11,0x10,0xFF,0x10,0x00,0xE0,0x40,0x40,0xE0,0x00,0x00,0x00,0x90,0x10,0xF0,0x00,0x00},/*"时",2*/
{0x00,0x9F,0x40,0x1F,0x92,0x92,0x92,0x92,0x9F,0x80,0xFF,0x00,0x00,0xF0,0x00,0xC0,0x40,0x40,0x40,0x40,0xD0,0x10,0xF0,0x00},/*"间",3*/
{0x44,0x22,0x00,0x03,0xFA,0xAB,0xAA,0xAB,0xFA,0x03,0x00,0x00,0x20,0x40,0x90,0xF0,0x10,0xF0,0x10,0xF0,0x10,0xF0,0x10,0x00},/*"温",4*/
{0x00,0x7F,0x50,0x51,0x7D,0x55,0xD5,0x55,0x7D,0x51,0x50,0x00,0x10,0xE0,0x00,0x10,0x90,0x50,0x20,0x20,0x50,0x90,0x10,0x00},/*"度",5*/
{0x11,0x16,0xFF,0x12,0x48,0x29,0x09,0xF9,0x09,0x29,0x4F,0x00,0x00,0x00,0xF0,0x00,0x20,0x20,0x20,0x20,0x20,0x20,0xF0,0x00},/*"档",6*/
{0x08,0x3F,0xC0,0x10,0x16,0x11,0x90,0x50,0x10,0x17,0x10,0x00,0x00,0xF0,0x00,0x10,0x10,0xD0,0x10,0x30,0xD0,0x10,0x10,0x00},/*"位",7*/
{0x41,0x41,0x5D,0x55,0x55,0xD5,0x55,0x55,0x5D,0x41,0x41,0x00,0xF0,0x00,0x00,0x70,0x50,0x50,0x50,0x70,0x00,0x10,0xF0,0x00},/*"高",8*/
{0x04,0x08,0x3F,0xC0,0x7F,0x44,0x44,0x7F,0x84,0x84,0x04,0x00,0x00,0x00,0xF0,0x00,0xE0,0x40,0xA0,0x10,0xC0,0x20,0xF0,0x00},/*"低",9*/
{0x3F,0x24,0x24,0x24,0xFF,0x24,0x24,0x24,0x3F,0x00,0x00,0x00,0xC0,0x80,0x80,0x80,0xE0,0x90,0x90,0x90,0x90,0x10,0x70,0x00},/*"电",10*/
{0x10,0xFF,0x95,0x95,0x95,0xDF,0xB5,0x95,0x95,0xFF,0x10,0x00,0x10,0x50,0x50,0x50,0x50,0xF0,0x50,0x50,0x50,0x50,0x10,0x00},/*"量",11*/
{0x44,0x4D,0x56,0xE4,0x48,0x44,0x59,0xE8,0x48,0x48,0x4F,0x00,0x90,0x90,0x90,0xA0,0xA0,0x20,0x00,0x80,0x10,0x10,0xE0,0x00},/*"药",12*/
{0x08,0x10,0xEF,0x29,0x29,0x29,0x2F,0x20,0x20,0x3F,0x00,0x00,0x00,0x00,0xE0,0x10,0x10,0x10,0x10,0x10,0x90,0x90,0x70,0x00},/*"包",13*/
{0x10,0x12,0x54,0x38,0x10,0xFD,0x10,0x38,0x54,0x12,0x10,0x00,0x90,0x90,0xA0,0xA0,0xC0,0x80,0xC0,0xA0,0xA0,0x90,0x90,0x00},/*"类",14*/
{0x09,0x4A,0x7C,0x48,0x48,0x7E,0x48,0x00,0x7C,0x01,0xFF,0x00,0x10,0x50,0x50,0x50,0x50,0xF0,0x50,0x50,0x50,0x50,0x10,0x00},/*"型",15*/
{0x15,0x5F,0x50,0x7F,0x90,0x9F,0x15,0x00,0x3F,0x00,0xFF,0x00,0x20,0x40,0x80,0xF0,0x80,0x40,0x20,0x00,0x80,0x10,0xF0,0x00},/*"剩",16*/
{0x08,0x09,0x11,0x29,0x49,0x8F,0x49,0x29,0x11,0x09,0x08,0x00,0x10,0x20,0x40,0x00,0x10,0xF0,0x00,0x00,0x40,0x20,0x10,0x00},/*"余",17*/
{0x84,0x47,0x00,0x20,0x2C,0x34,0xE4,0x2F,0x24,0x24,0x20,0x00,0x10,0xE0,0x10,0x90,0x90,0x90,0x90,0xF0,0x90,0x90,0x90,0x00},/*"连",18*/
{0x11,0x11,0xFF,0x12,0x25,0x35,0xAD,0x67,0x2D,0x35,0x25,0x00,0x00,0x10,0xF0,0x00,0x10,0x50,0xD0,0x20,0x20,0xD0,0x10,0x00},/*"接",19*/
{0x00,0x3F,0x24,0x24,0x27,0x20,0xFF,0x20,0xA1,0x66,0x20,0x00,0x10,0xE0,0x00,0x40,0xD0,0x20,0x40,0x80,0x40,0x20,0xF0,0x00},/*"成",20*/
{0x20,0x20,0x3F,0x20,0x20,0x10,0xFF,0x10,0x10,0x10,0x1F,0x00,0x40,0x40,0x80,0x90,0xA0,0xC0,0x00,0x00,0x10,0x10,0xE0,0x00},/*"功",21*/
{0x05,0x09,0x71,0x11,0x11,0xFF,0x11,0x11,0x11,0x01,0x01,0x00,0x10,0x10,0x20,0x40,0x80,0x00,0x80,0x40,0x20,0x10,0x10,0x00},/*"失",22*/
{0x7F,0x40,0x5F,0x40,0x7F,0x08,0x37,0xD0,0x10,0x1F,0x10,0x00,0x90,0x20,0xC0,0x20,0x90,0x10,0xA0,0x40,0xA0,0x10,0x10,0x00},/*"败",23*/
{0x04,0x44,0x44,0x44,0x47,0x7C,0x47,0x44,0x44,0x44,0x04,0x00,0x10,0x20,0x40,0x80,0x00,0x00,0xE0,0x10,0x10,0x10,0x70,0x00},/*"无",24*/
{0x00,0x7F,0x49,0x49,0x7F,0x0A,0x73,0x42,0x42,0x7B,0x08,0x00,0x10,0xE0,0x00,0x10,0xF0,0x10,0xA0,0x40,0xA0,0x10,0x10,0x00},/*"股",25*/
{0x0C,0x08,0xFB,0xAA,0xAA,0xAA,0xBA,0x8A,0xFB,0x08,0x0C,0x00,0x00,0x00,0xF0,0xA0,0xA0,0xA0,0xA0,0xB0,0xF0,0x00,0x00,0x00},/*"骨",26*/
{0x08,0x3F,0xC0,0x26,0x3B,0x11,0x55,0xFF,0x55,0x7D,0x10,0x00,0x00,0xF0,0x00,0x50,0xE0,0x50,0x50,0xF0,0x50,0x50,0x50,0x00},/*"健",27*/
{0x2F,0x28,0x28,0xFF,0x28,0x29,0x2F,0x00,0x3F,0x00,0xFF,0x00,0x20,0x40,0x80,0xF0,0x80,0x40,0x20,0x00,0x80,0x10,0xF0,0x00},/*"刺",28*/
{0x00,0x9F,0x40,0x1F,0x92,0x92,0x92,0x92,0x9F,0x80,0xFF,0x00,0x00,0xF0,0x00,0xC0,0x40,0x40,0x40,0x40,0xD0,0x10,0xF0,0x00},/*"间",29*/
{0x09,0x0A,0x7C,0x48,0xEC,0x5A,0x48,0x4A,0x7E,0x08,0x08,0x00,0x10,0xF0,0x90,0x90,0xF0,0x90,0xF0,0x90,0x90,0xF0,0x10,0x00},/*"盘",30*/
{0x00,0x7F,0x48,0x44,0x43,0x44,0x58,0x40,0x7F,0x00,0x00,0x00,0x10,0xE0,0x40,0x80,0x00,0x80,0x40,0x00,0xC0,0x20,0xF0,0x00},/*"风",31*/
{0x10,0x09,0x7F,0x40,0x57,0x55,0xDD,0x57,0x5D,0x55,0x47,0x00,0x90,0x20,0xC0,0x00,0xF0,0x40,0x40,0xE0,0x40,0x50,0xF0,0x00},/*"痛",32*/
{0x02,0x0C,0xF2,0x11,0x1E,0x00,0x00,0xFF,0x08,0x04,0x03,0x00,0x10,0x20,0x40,0x80,0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x00},/*"外",33*/
{0x04,0x08,0x3F,0xC0,0x08,0x12,0xE2,0x2F,0x22,0x22,0x23,0x00,0x00,0x00,0xF0,0x00,0x10,0x20,0xC0,0x00,0x10,0x10,0xE0,0x00},/*"伤",34*/
{0x3F,0x20,0x3F,0x00,0x24,0x2C,0xB5,0x66,0x24,0x29,0x22,0x00,0xC0,0x80,0xC0,0x00,0x90,0x90,0x20,0x40,0xC0,0x20,0x10,0x00},/*"咳",35*/
{0x7F,0x40,0x7F,0x00,0x75,0x15,0x15,0xF7,0x15,0x15,0x75,0x00,0xC0,0x80,0xC0,0x00,0xF0,0x00,0xE0,0x00,0xE0,0x10,0xF0,0x00},/*"喘",36*/
{0x88,0x4F,0x00,0x00,0xFF,0x84,0x95,0xBD,0x95,0x84,0xFF,0x00,0x00,0xE0,0x40,0x10,0xE0,0x00,0xC0,0x40,0xD0,0x10,0xF0,0x00},/*"调",37*/
{0x19,0x2B,0xCD,0x11,0x02,0x45,0x49,0x51,0x69,0x45,0x02,0x00,0x20,0x20,0x40,0x40,0x10,0x10,0x10,0xF0,0x10,0x10,0x10,0x00},/*"经",38*/
{0x20,0x20,0xFF,0x2A,0x2A,0x2A,0x2A,0x2A,0xFF,0x20,0x20,0x00,0x80,0x90,0xA0,0x80,0x80,0x80,0x80,0x80,0xA0,0x90,0x80,0x00},/*"其",39*/
{0x38,0x20,0x2F,0x21,0xA1,0x62,0x22,0x24,0x24,0x20,0x38,0x00,0x00,0x00,0xE0,0x10,0x10,0x10,0x10,0x10,0x10,0x70,0x00,0x00}};/*"它",40*/


const char HZ_16x16[6][32]={
{0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x3F,0x20,0x20,0x20,0x20,0x20,0x20,0x00,0x00,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0xFC,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x00},/*"工",0*/
{0x00,0x01,0x06,0x1F,0xE0,0x02,0x0C,0xF0,0x1F,0x11,0x11,0x11,0x11,0x10,0x10,0x00,0x80,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0xFF,0x10,0x10,0x10,0x10,0x10,0x00,0x00},/*"作",1*/
{0x41,0x59,0x69,0xC9,0x5F,0x4A,0x4A,0x01,0x7E,0x48,0x48,0x48,0x8F,0x88,0x08,0x00,0x00,0x80,0x00,0x7F,0xC9,0x49,0xC9,0x49,0x49,0x49,0x49,0x7F,0xC0,0x00,0x00,0x00},/*"暂",2*/
{0x01,0x06,0x1F,0xE0,0x00,0x20,0x2E,0x2A,0xAA,0x6A,0x2A,0x2A,0x2E,0x20,0x00,0x00,0x00,0x00,0xFF,0x00,0xC0,0x80,0xA0,0xA2,0xA1,0xBE,0xA0,0xA0,0xA0,0x80,0xC0,0x00},/*"停",3*/
{0x08,0x30,0x20,0x24,0x24,0x24,0xA4,0x64,0x24,0x24,0x24,0x24,0x20,0x28,0x30,0x00,0x00,0x81,0x81,0x82,0x8C,0xF0,0x80,0x80,0x80,0xFE,0x81,0x81,0x81,0x8F,0x00,0x00},/*"完",4*/
{0x00,0x00,0x1F,0x11,0x11,0x11,0x11,0x10,0x10,0xFF,0x10,0x90,0x50,0x13,0x10,0x00,0x01,0x06,0xF8,0x00,0x08,0x04,0xF8,0x01,0x02,0x84,0x68,0x18,0x64,0x82,0x1F,0x00}};/*"成",5*/


// LCD初始化
void LCD_12848_Init(void)
{
  IO_LcdRES = 1;
  DelayMS(3);
  IO_LcdRES = 0;
  DelayMS(3);
  IO_LcdRES = 1;
  DelayMS(10);

  Write_Com(0xa2);	//1/8 Bias
  Write_Com(0xa6);	//黑白取反
  Write_Com(0xa0);	//0xa1，0xa0
  Write_Com(0xc8);	//行基准在上端0xc8，行基准在下端0xc0       
  Write_Com(0x24);	//对比度调节，有效值范围：0x20-0x27粗调，每升高一阶电压增加零点几伏
  Write_Com(0x81);	//对比度调节
  Write_Com(0x12);	//对比度调节，有效值范围：0x00-0x3F微调，每升高一阶电压增加零点零几伏
  Write_Com(0x2c);      //Booster电源开
  DelayMS(20);                     
  Write_Com(0x2e);      //Regulator电源开
  DelayMS(20);                     
  Write_Com(0x2f);	//Follower电源开
  DelayMS(20);

  HAL_ON_IO_LcdBL();    //打开LCD背光
  DelayMS(10);
  Write_Com(0xaf);	//Lcd Disply ON
  DelayMS(2);
  LCD_Clear();
}
void IO_LCD_Init(void)
{
  /*配置成输出模式*/
  IO_LcdBL_DDR  |= IO_LcdBL_BV;
  IO_LcdRES_DDR |= IO_LcdRES_BV;
  IO_LcdA0_DDR  |= IO_LcdA0_BV;;
  IO_LcdSCL_DDR |= IO_LcdSCL_BV;
  I2CWC = 0x82;//将I2C引脚设置成普通IO口使用
  
  HAL_OFF_IO_LcdBL();
  HAL_OFF_IO_LcdRES();
  HAL_OFF_IO_LcdA0();
  HAL_OFF_IO_LcdSCL();
  IO_LcdSDA_L;
}
void LCD_12848_End(void)
{
    Write_Com(0xae);	
    HAL_OFF_IO_LcdBL();  
}
// LCD全屏填充同一个数据，实现清屏效果
void LCD_Clear(void)
{
  uint8 i,j;
  for(i=0Xb0;i<0Xb6;i++)
  {
    Write_Com(i);
    Write_Com(0x10);
    Write_Com(0x00);
    for(j=0;j<128;j++)
    {
      Write_Data(0x00);
    }
  }
}
void ASCII_6x12_Display(const char (*font)[12],uint8 line,uint8 col)
{
  uint8 i,j,k,l;
  uint8 o = 11;
   if(line == 1)
   {
      k = 0xb0;
      l = 0xb2;
   }
   else if(line == 2)
   {
      k = 0xb2;
      l = 0xb4;
   }
   else if(line == 3)
   {
      k = 0xb4;
      l = 0xb6;        
   }
   else 
   {
      k = 0;
      l = 0;  
   }
   for(i=k;i<l;i++)
   {
     Write_Com(i);
     Write_Com((col>>4) | 0x10);
     Write_Com(col & 0x0f);

     for(j=0;j<6;j++)
     {

       Write_Data(*(*font+o));
       o--;
     }
    }
}
void HZ_12x12_Display(const char (*font)[24],uint8 line,uint8 col)
{
  uint8 i,j,k,l;
  uint8 o = 23;
   if(line == 1)
   {
      k = 0xb0;
      l = 0xb2;
   }
   else if(line == 2)
   {
      k = 0xb2;
      l = 0xb4;
   }
   else if(line == 3)
   {
      k = 0xb4;
      l = 0xb6;        
   }
   else 
   {
      k = 0;
      l = 0;  
   }
   for(i=k;i<l;i++)
   {
     Write_Com(i);
     Write_Com((col>>4) | 0x10);
     Write_Com(col & 0x0f);

     for(j=0;j<12;j++)
     {

       Write_Data(*(*font+o));
       o--;
     }
    }
}
void HZ_16x16_Display(const char (*font)[32],uint8 col)
{
  uint8 i,j;
  uint8 o = 31;

   for(i=0xb1;i<0xb3;i++)
   {
     Write_Com(i);
     Write_Com((col>>4) | 0x10);
     Write_Com(col & 0x0f);

     for(j=0;j<16;j++)
     {
       Write_Data(*(*font+o));
       o--;
     }
    }
} 


// LCD写一个字节数据
void Write_Data(uint8 para)
{
    uint8 j;
    j        = 8;
    //    CS       = 0;
    IO_LcdA0 = 1;
    do
    {
      if(para&0x80)IO_LcdSDA_H; 
      else         IO_LcdSDA_L;
      IO_LcdSCL   = 0;
      IO_LcdSCL   = 1;
      --j;
      para<<=1;
    }
      while(j);
    //    CS       = 1;
}

// LCD写一个字节命令
void Write_Com(uint8 para)
{
    uint8 j;
    j        = 8;
//    CS       = 0;
    IO_LcdA0 = 0;
    do
    {
      if(para&0x80)IO_LcdSDA_H;
      else         IO_LcdSDA_L;
      IO_LcdSCL   = 0;
      IO_LcdSCL   = 1;
      --j;
      para<<=1;
    }
    while(j);
    //    CS       = 1;
}

void DelayMS(uint16 ms)//32MHz
{ 
    uint16 a;
    while(ms)
    {
      a=1500;
      while(a--);
      ms--;
    }
}

void DelayUS(uint16 us)//32MHz //超过50us不准
{ 
    while(us)
    {
      us--;
    }
    us ++;
}

#endif

